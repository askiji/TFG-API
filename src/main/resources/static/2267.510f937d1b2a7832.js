"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2267],{2267:(D,m,_)=>{_.r(m),_.d(m,{HomePage:()=>w});var b=_(5861),p=_(6895),d=_(6114),f=_(433),g=_(2340),e=_(8256),T=_(529),C=_(1407),P=_(1481);function O(n,s){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.hij(" ",t," ")}}function x(n,s){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,O,2,1,"td",6),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}const M=function(n,s){return{"sticky-cell":n,recreo:s}};function E(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"td",12),e.NdJ("click",function(){const a=e.CHM(t),i=a.$implicit,l=a.index,r=e.oxw().index,h=e.oxw();return e.KtG(h.show(i,r,l))}),e.qZA()}if(2&n){const t=s.$implicit;e.Q6J("ngClass",e.WLB(2,M,0==s.index,"recreo"==t))("innerHTML",t,e.oJD)}}function H(n,s){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,E,1,5,"td",11),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Q6J("ngForOf",t)}}function v(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"ion-datetime",14),e.NdJ("ngModelChange",function(a){e.CHM(t);const i=e.oxw();return e.KtG(i.fechaAusencia=a)})("ngModelChange",function(a){e.CHM(t);const i=e.oxw();return e.KtG(i.onFechaAusenciaChange(a))})("ionChange",function(a){e.CHM(t);const i=e.oxw();return e.KtG(i.onChange(a))})("ionCancel",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onCancel())}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.fechaAusencia)("showDefaultButtons",!0)}}const A=function(n){return{"de-guardia":n}};function y(n,s){if(1&n&&(e.TgZ(0,"div",19),e._uU(1),e.qZA()),2&n){const t=s.$implicit,o=e.oxw(2);e.Q6J("ngClass",e.VKq(2,A,o.esElProfesor(t))),e.xp6(1),e.hij("- ",t,")")}}function Z(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div"),e._uU(1),e.TgZ(2,"ion-button",16),e.NdJ("click",function(){const i=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.asegurarGuardia(i))}),e._uU(3),e.qZA()()}if(2&n){const t=s.$implicit;e.xp6(1),e.hij(" ",t.clase," "),e.xp6(2),e.hij(" ",t.nombreSuplente?"Eleminar":"Realizar"," Guardia")}}function k(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Modal"),e.qZA(),e.TgZ(4,"ion-buttons",15)(5,"ion-button",16),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.setOpen(!1))}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content",17),e.YNc(8,y,2,4,"div",18),e.YNc(9,Z,4,2,"div",6),e.qZA()}if(2&n){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",t.profesoresDeGuardia),e.xp6(1),e.Q6J("ngForOf",t.guardiasDeProfesores)}}let w=(()=>{class n{constructor(t,o,a,i,l){this.http=t,this.route=o,this.toastController=a,this.sanitizer=i,this.router=l,this.header=[[" ","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes"]],this.data=[],this.datosProfesores={},this.showCalendar=!1,this.altura="600px",this.isModalOpen=!1,this.profesoresDeGuardia="",this.guardiastTemp=[],this.guardiasDeProfesores=[],this.realName=""}ngOnInit(){}ionViewDidEnter(){this.createCalendar(),this.queryTeacher(),this.getProofesores()}getProofesores(){this.http.get(`${g.N.apiUrl}/profesor/guardias`).subscribe(t=>{console.log(t),this.datosProfesores=t.data})}asegurarGuardia(t){t.nombreSuplente?this.eliminarGuardia(t):this.http.post(`${g.N.apiUrl}/ausencia/update`,t).subscribe(()=>{this.presentToast("Se le ha asignado como suplente"),this.isModalOpen=!1,t.nombreSuplente=this.route.snapshot.paramMap.get("teacher")})}eliminarGuardia(t){t.nombreSuplente=null,this.http.post(`${g.N.apiUrl}/ausencia/update`,t).subscribe(()=>{this.presentToast("Se le ha desasignado como suplente"),this.isModalOpen=!1})}setOpen(t){this.isModalOpen=t}getHeight(){setTimeout(()=>{document.body.scrollHeight>0&&(this.altura=document.body.scrollHeight+"px")},500)}onResize(t){console.log(t.target.innerWidth),this.altura=document.body.scrollHeight+"px"}queryTeacher(){const t=this.route.snapshot.paramMap.get("teacher");this.http.get(`${g.N.apiUrl}/profesores/${t}`).subscribe(o=>{o?(this.realName=Object.keys(o.data)[0],Object.keys(o.data).forEach((a,i)=>{0==i&&this.mapHorario(o,a),this.mapAsignaturas(o,a,i),this.getHeight()})):this.router.navigateByUrl("/selecion")})}mapHorario(t,o){for(let a=0;a<Object.keys(t.data[o]).length;a++)0!=a&&(this.data[a-1][0]=t.data[o][a]?t.data[o][a]:"recreo")}esElProfesor(t){let o=t.split(" "),a=this.realName.split(" "),i=0;return o.forEach(l=>{a.includes(l)&&i++}),i>2}mapAsignaturas(t,o,a){const i={Lunes:1,Martes:2,Mi\u00e9rcoles:3,Jueves:4,Viernes:5};Object.keys(t.data[o]).forEach((l,r)=>{0!=r&&(this.data[r-1][i[o]]=t.data[o][l],this.data[r-1][i[o]]&&this.data[r-1][i[o]].toLowerCase().indexOf("guardia")>-1&&this.http.get(`${g.N.apiUrl}/ausencia/${i[o]}`).subscribe(h=>{if(console.log("asencias",h),h.length>0){var u="";h.forEach(c=>{this.guardiastTemp[r-1][a]?this.guardiastTemp[r-1][a].push({id:c.id,fecha:c.fecha,nombre:c.nombre,clase:c.clases[r-1],nombreSuplente:c.nombreSuplente}):this.guardiastTemp[r-1][a]=[{id:c.id,fecha:c.fecha,nombre:c.nombre,clase:c.clases[r-1],nombreSuplente:c.nombreSuplente}],console.log("gg",this.guardiastTemp),u=u+c.clases[r-1]+""+(c.nombreSuplente?" ("+c.nombreSuplente+")":"")}),"null"!=u&&(this.data[r-1][i[o]]=this.sanitizer.bypassSecurityTrustHtml(`<div class="click" style="background-color: greenyellow !important; color: black; " >${u}</div>`))}}))})}show(t,o,a){t.changingThisBreaksApplicationSecurity&&t.changingThisBreaksApplicationSecurity.toString().indexOf("click")>-1&&(this.profesoresDeGuardia=this.datosProfesores[{1:"LUNES",2:"MARTES",3:"MI\xc9RCOLES",4:"JUEVES",5:"VIERNES"}[a]][o].split(")").filter(l=>l.length>1),console.log(),this.guardiasDeProfesores=this.guardiastTemp[o][a],this.setOpen(!0))}createCalendar(){for(let t=0;t<17;t++){this.data.push([]),this.guardiastTemp.push([]);for(let o=0;o<6;o++)this.data[t][o]="-"}}calendario(){this.showCalendar=!this.showCalendar}onFechaAusenciaChange(t){console.log("Fecha seleccionada:",t)}onCancel(){console.log("Se hizo clic en el bot\xf3n de Cancelar"),this.showCalendar=!this.showCalendar}onChange(t){console.log("Se seleccion\xf3 la fecha:",t.detail.value),this.fechaAusencia=t.detail.value,this.showCalendar=!this.showCalendar,this.enviarFecha()}enviarFecha(){const a=["Domingo","1","2","3","4","5","S\xe1bado"][new Date(this.fechaAusencia).getDay()];console.log(a);let i=[];this.data.forEach((l,r)=>{i.push(this.data[r][a])}),console.log(i),this.http.post(`${g.N.apiUrl}/ausencia`,{nombre:this.route.snapshot.paramMap.get("teacher"),fecha:new Date(this.fechaAusencia).getTime(),clases:i}).subscribe(l=>{this.presentToast("Su asuencia OK")},l=>{this.presentToast("No se ha podido guardar la ausencia")})}presentToast(t){var o=this;return(0,b.Z)(function*(){yield(yield o.toastController.create({message:t,duration:1500,position:"middle"})).present()})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.eN),e.Y36(C.gz),e.Y36(d.yF),e.Y36(P.H7),e.Y36(C.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-home"]],hostBindings:function(t,o){1&t&&e.NdJ("resize",function(i){return o.onResize(i)},!1,e.Jf7)},standalone:!0,features:[e.jDz],decls:21,vars:10,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[1,"table-container"],[1,"fixed-row"],[4,"ngFor","ngForOf"],[1,"boton-flotante",3,"click"],["class","contenedor",4,"ngIf"],["message","This toast will disappear after 5 seconds",3,"isOpen","duration"],[3,"isOpen"],[3,"ngClass","innerHTML","click",4,"ngFor","ngForOf"],[3,"ngClass","innerHTML","click"],[1,"contenedor"],[3,"ngModel","showDefaultButtons","ngModelChange","ionChange","ionCancel"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3," Guardias IES Sampedro "),e.qZA()()(),e.TgZ(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),e._uU(8,"Guardias IES Sampedro"),e.qZA()()(),e.TgZ(9,"div",4)(10,"table")(11,"thead",5),e.YNc(12,x,2,1,"tr",6),e.qZA(),e.TgZ(13,"tbody"),e.YNc(14,H,2,1,"tr",6),e.qZA()()(),e.TgZ(15,"button",7),e.NdJ("click",function(){return o.calendario()}),e._uU(16,"Ausencia"),e.qZA(),e.YNc(17,v,2,2,"div",8),e._UZ(18,"ion-toast",9),e.qZA(),e.TgZ(19,"ion-modal",10),e.YNc(20,k,10,2,"ng-template"),e.qZA()),2&t&&(e.Q6J("translucent",!0),e.xp6(4),e.Q6J("fullscreen",!0),e.xp6(5),e.Udp("height",o.altura),e.xp6(3),e.Q6J("ngForOf",o.header),e.xp6(2),e.Q6J("ngForOf",o.data),e.xp6(3),e.Q6J("ngIf",o.showCalendar),e.xp6(1),e.Q6J("isOpen",!0)("duration",5e3),e.xp6(1),e.Q6J("isOpen",o.isModalOpen))},dependencies:[d.Pc,d.YG,d.Sm,d.W2,d.x4,d.Gu,d.wd,d.Px,d.sr,d.ki,d.QI,p.ez,p.mk,p.sg,p.O5,f.u5,f.JJ,f.On],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}td[_ngcontent-%COMP%]{padding:8px;border:1px solid black}.sticky-cell[_ngcontent-%COMP%]{position:sticky;left:0;z-index:1;background-color:var(--ion-color-tertiary)}.fixed-row[_ngcontent-%COMP%]{position:sticky;top:0}tbody[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:red}.boton-flotante[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;padding:12px 24px;font-size:16px;background-color:#4caf50;color:#fff;border-radius:4px;box-shadow:0 2px 5px #00000080;border:none;cursor:pointer}.contenedor[_ngcontent-%COMP%]{width:300px;height:200px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;border:1px solid #000;box-shadow:0 2px 5px #00000080}.resaltar[_ngcontent-%COMP%]{background-color:#adff2f!important;color:#000}.recreo[_ngcontent-%COMP%]{background-color:var(--ion-color-tertiary-contrast);color:#000}.de-guardia[_ngcontent-%COMP%]{color:#ff0}']}),n})()}}]);